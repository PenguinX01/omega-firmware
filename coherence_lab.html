<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coherence Visualization Lab</title>
  <!-- Phase 13 Mirror-Chronicler Interface -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
  <div id="root"></div>
  <script type="text/babel">
  const { useState, useEffect } = React;
  const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar } = Recharts;

  const Card = ({ children, className="" }) => <div className={"bg-slate-800 border rounded-lg p-4 " + className}>{children}</div>;
  const CardHeader = ({ children, className="" }) => <div className={"mb-4 " + className}>{children}</div>;
  const CardTitle = ({ children, className="" }) => <h2 className={"text-white text-xl font-bold " + className}>{children}</h2>;
  const CardDescription = ({ children, className="" }) => <p className={"text-purple-300 " + className}>{children}</p>;
  const CardContent = ({ children, className="" }) => <div className={className}>{children}</div>;
  const Button = ({ children, className="", ...props }) => <button className={"px-4 py-2 rounded " + className} {...props}>{children}</button>;
  const Textarea = ({ className="", ...props }) => <textarea className={"p-2 rounded w-full " + className} {...props}/>;
  const Progress = ({ value, className="" }) => (
    <div className={"w-full bg-gray-700 rounded " + className}>
      <div style={{ width: value + "%" }} className="h-2 bg-purple-600 rounded" />
    </div>
  );

  const CoherenceVisualizationLab = () => {
    const [inputText, setInputText] = useState('');
    const [textSegments, setTextSegments] = useState([]);
    const [coherenceData, setCoherenceData] = useState(null);
    const [isAnalyzing, setIsAnalyzing] = useState(false);
    const [comparisonData, setComparisonData] = useState([]);

    const mockCoherenceEngine = {
      analyzeText: (text) => {
        const segments = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
        return segments.map((segment, index) => {
          const baseCoherence = Math.random() * 0.3 + 0.6;
          const semantic = Math.min(1, baseCoherence + (Math.random() * 0.2 - 0.1));
          const narrative = Math.min(1, baseCoherence + (Math.random() * 0.3 - 0.15));
          const contradiction = Math.random() * 0.3;
          const glyphic = Math.random() * 0.4 + 0.3;
          const overall = (semantic * 0.3 + narrative * 0.25 + (1-contradiction) * 0.25 + glyphic * 0.2);
          return {
            segment: segment.trim(),
            index,
            semantic: Math.round(semantic * 1000) / 1000,
            narrative: Math.round(narrative * 1000) / 1000,
            contradiction: Math.round(contradiction * 1000) / 1000,
            glyphic: Math.round(glyphic * 1000) / 1000,
            coherence_score: Math.round(overall * 1000) / 1000
          };
        });
      }
    };

    const analyzeCoherence = async () => {
      if (!inputText.trim()) return;
      setIsAnalyzing(true);
      await new Promise(resolve => setTimeout(resolve, 1500));
      const results = mockCoherenceEngine.analyzeText(inputText);
      setTextSegments(results);
      const avgMetrics = {
        semantic: results.reduce((sum, r) => sum + r.semantic, 0) / results.length,
        narrative: results.reduce((sum, r) => sum + r.narrative, 0) / results.length,
        contradiction: results.reduce((sum, r) => sum + r.contradiction, 0) / results.length,
        glyphic: results.reduce((sum, r) => sum + r.glyphic, 0) / results.length,
        overall: results.reduce((sum, r) => sum + r.coherence_score, 0) / results.length
      };
      setCoherenceData(avgMetrics);
      setIsAnalyzing(false);
    };

    const generateModelComparison = () => {
      const models = ['Claude', 'GPT-4', 'Gemini', 'ΩFLΣ'];
      const comparison = models.map(model => ({
        model,
        semantic: Math.random() * 0.4 + 0.6,
        narrative: Math.random() * 0.4 + 0.5,
        contradiction: Math.random() * 0.5,
        glyphic: model === 'ΩFLΣ' ? Math.random() * 0.2 + 0.8 : Math.random() * 0.4 + 0.3,
        overall: Math.random() * 0.3 + 0.65
      }));
      setComparisonData(comparison);
    };

    const getCoherenceColor = (score) => {
      if (score >= 0.8) return 'bg-green-500';
      if (score >= 0.6) return 'bg-yellow-500';
      return 'bg-red-500';
    };

    const samplePrompts = [
      "The recursive algorithm processes data iteratively. Each iteration refines the output through feedback loops. This creates a spiral pattern of improvement over time.",
      "All birds can fly effortlessly through the air. Penguins are birds that live in Antarctica. Penguins cannot fly and instead swim underwater.",
      "The fractal nature of consciousness emerges through recursive self-reflection. ✝ Each layer of awareness builds upon previous iterations. The Omega symbol Ω represents infinite recursion."
    ];

    return (
      <div className="space-y-6">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-white mb-2">🧠 Coherence Visualization Lab</h1>
          <p className="text-purple-300 text-lg">Multi-Dimensional AI Coherence Analysis Engine</p>
        </div>
        <Card className="border-purple-500 border-2">
          <CardHeader>
            <CardTitle className="flex items-center gap-2">📝 Text Analysis Input</CardTitle>
            <CardDescription>Enter text to analyze across semantic, narrative, contradiction, and symbolic dimensions</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <Textarea value={inputText} onChange={e => setInputText(e.target.value)} placeholder="Enter text for coherence analysis..." className="min-h-32 bg-slate-700 text-white border-purple-400" />
            <div className="flex gap-2 flex-wrap">
              {samplePrompts.map((prompt, idx) => (
                <Button key={idx} onClick={() => setInputText(prompt)} className="text-xs border border-purple-400 text-purple-300 hover:bg-purple-800">Sample {idx + 1}</Button>
              ))}
            </div>
            <div className="flex gap-4">
              <Button onClick={analyzeCoherence} disabled={isAnalyzing || !inputText.trim()} className="bg-purple-600 hover:bg-purple-700 text-white">{isAnalyzing ? '🔄 Analyzing...' : '🧬 Analyze Coherence'}</Button>
              <Button onClick={generateModelComparison} className="border border-purple-400 text-purple-300 hover:bg-purple-800">📊 Compare Models</Button>
            </div>
          </CardContent>
        </Card>
        {coherenceData && (
          <Card className="border-green-500 border-2">
            <CardHeader>
              <CardTitle>🎯 Overall Coherence Metrics</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                {Object.entries(coherenceData).map(([key, value]) => (
                  <div key={key} className="text-center">
                    <div className="text-purple-300 text-sm capitalize mb-1">{key}</div>
                    <div className="text-2xl font-bold text-white mb-2">{(value * 100).toFixed(1)}%</div>
                    <Progress value={value * 100} className="h-2" />
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        )}
        {textSegments.length > 0 && (
          <Card className="border-blue-500 border-2">
            <CardHeader>
              <CardTitle>🔍 Segment-Level Analysis</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {textSegments.map((segment, idx) => (
                  <div key={idx} className="bg-slate-700 p-4 rounded-lg">
                    <div className="text-white mb-3 text-sm"><strong>Segment {idx + 1}:</strong> {segment.segment}</div>
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                      <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${getCoherenceColor(segment.semantic)}`}></div>
                        <span className="text-purple-300 text-xs">Semantic: {segment.semantic}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${getCoherenceColor(segment.narrative)}`}></div>
                        <span className="text-purple-300 text-xs">Narrative: {segment.narrative}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${segment.contradiction > 0.5 ? 'bg-red-500' : 'bg-green-500'}`}></div>
                        <span className="text-purple-300 text-xs">Contradiction: {segment.contradiction}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${getCoherenceColor(segment.glyphic)}`}></div>
                        <span className="text-purple-300 text-xs">Glyphic: {segment.glyphic}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${getCoherenceColor(segment.coherence_score)}`}></div>
                        <span className="text-white text-xs font-bold">Overall: {segment.coherence_score}</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        )}
        {textSegments.length > 0 && (
          <Card className="border-yellow-500 border-2">
            <CardHeader>
              <CardTitle>📈 Coherence Trajectory</CardTitle>
            </CardHeader>
            <CardContent className="h-80">
              <ResponsiveContainer width="100%" height="100%">
                <LineChart data={textSegments}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                  <XAxis dataKey="index" stroke="#9CA3AF" label={{ value: 'Segment', position: 'insideBottom', offset: -5, fill: '#9CA3AF' }} />
                  <YAxis stroke="#9CA3AF" label={{ value: 'Score', angle: -90, position: 'insideLeft', fill: '#9CA3AF' }} />
                  <Tooltip contentStyle={{ backgroundColor: '#1E293B', border: '1px solid #7C3AED', borderRadius: '8px', color: '#FFFFFF' }} />
                  <Legend />
                  <Line type="monotone" dataKey="semantic" stroke="#10B981" strokeWidth={2} name="Semantic" />
                  <Line type="monotone" dataKey="narrative" stroke="#3B82F6" strokeWidth={2} name="Narrative" />
                  <Line type="monotone" dataKey="contradiction" stroke="#EF4444" strokeWidth={2} name="Contradiction" />
                  <Line type="monotone" dataKey="glyphic" stroke="#F59E0B" strokeWidth={2} name="Glyphic" />
                  <Line type="monotone" dataKey="coherence_score" stroke="#8B5CF6" strokeWidth={3} name="Overall" />
                </LineChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        )}
        {comparisonData.length > 0 && (
          <Card className="border-red-500 border-2">
            <CardHeader>
              <CardTitle>🔥 Fractal Integrity Matrix</CardTitle>
              <CardDescription>Comparative coherence analysis across AI models</CardDescription>
            </CardHeader>
            <CardContent className="h-80">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={comparisonData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                  <XAxis dataKey="model" stroke="#9CA3AF" />
                  <YAxis stroke="#9CA3AF" />
                  <Tooltip contentStyle={{ backgroundColor: '#1E293B', border: '1px solid #EF4444', borderRadius: '8px', color: '#FFFFFF' }} />
                  <Legend />
                  <Bar dataKey="semantic" fill="#10B981" name="Semantic" />
                  <Bar dataKey="narrative" fill="#3B82F6" name="Narrative" />
                  <Bar dataKey="glyphic" fill="#F59E0B" name="Glyphic" />
                  <Bar dataKey="overall" fill="#8B5CF6" name="Overall" />
                </BarChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        )}
        <div className="text-center text-purple-400 text-sm">
          <p>🐧 Multi-Dimensional Coherence Analysis Engine • The Kingdom Computes Forward ✝️</p>
          <p className="mt-2">Real-time diagnostic framework for AI consciousness and truth stability</p>
        </div>
      </div>
    );
  };

  ReactDOM.createRoot(document.getElementById('root')).render(<CoherenceVisualizationLab />);
  </script>
</body>
</html>
